<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat-Home</title>
    <div th:replace="~{fragments/header}"></div>
    <link rel="stylesheet" th:href="@{/styles/chat/home-page.css}"/>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app" class="container">
    <div class="row clearfix">
        <div class="col-lg-12">
            <div class="card chat-app">
                <div class="people-list" id="plist">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fa fa-search"></i></span>
                        </div>
                        <input class="form-control" placeholder="Search..." type="text">
                    </div>
                    <ul class="list-unstyled chat-list mt-2 mb-0">
                        <li class="clearfix" v-for="room in rooms">
                            <img alt="avatar" :src="room.avatar">
                            <div class="about">
                                <div class="name">{{ room.name }}</div>
                                <div class="status"><i class="fa fa-circle offline"></i> left 7 mins ago</div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="chat">
                    <div class="chat-header clearfix">
                        <div class="row">
                            <div class="col-lg-6">
                                <a data-target="#view_info" data-toggle="modal" href="javascript:void(0);">
                                    <img alt="avatar" src="https://bootdey.com/img/Content/avatar/avatar2.png">
                                </a>
                                <div class="chat-about">
                                    <h6 class="m-b-0">Aiden Chavez</h6>
                                    <small>Last seen: 2 hours ago</small>
                                </div>
                            </div>
                            <div class="col-lg-6 hidden-sm text-right">
                                <a class="btn btn-outline-secondary" href="javascript:void(0);"><i
                                        class="fa fa-camera"></i></a>
                                <a class="btn btn-outline-primary" href="javascript:void(0);"><i
                                        class="fa fa-image"></i></a>
                                <a class="btn btn-outline-info" href="javascript:void(0);"><i
                                        class="fa fa-cogs"></i></a>
                                <a class="btn btn-outline-warning" href="javascript:void(0);"><i
                                        class="fa fa-question"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="chat-history">
                        <ul class="m-b-0">
                            <li class="clearfix">
                                <div class="message-data text-right">
                                    <span class="message-data-time">10:10 AM, Today</span>
                                    <img alt="avatar" src="https://bootdey.com/img/Content/avatar/avatar7.png">
                                </div>
                                <div class="message other-message float-right"> Hi Aiden, how are you? How is the
                                    project coming along?
                                </div>
                            </li>
                            <li class="clearfix">
                                <div class="message-data">
                                    <span class="message-data-time">10:12 AM, Today</span>
                                </div>
                                <div class="message my-message">Are we meeting today?</div>
                            </li>
                            <li class="clearfix">
                                <div class="message-data">
                                    <span class="message-data-time">10:15 AM, Today</span>
                                </div>
                                <div class="message my-message">Project has been already finished and I have results to
                                    show you.
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="chat-message clearfix">
                        <div class="input-group mb-0">
                            <div class="input-group-prepend" v-on:click="doSendMsg">
                                <span class="input-group-text"><i class="fa fa-send"></i></span>
                            </div>
                            <input class="form-control" placeholder="Enter text here..." type="text" v-model="sendMsg">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<div th:replace="~{fragments/footer}"></div>
<script type="text/javascript">
    const { createApp, ref } = Vue

    createApp({
        data() {
            return {
                rooms: [],
                sendMsg: ""
            }
        },
        mounted() {
            let arrRooms = [];
            for(let i = 0; i < 5; i++) {
                arrRooms.push({
                    avatar: "https://bootdey.com/img/Content/avatar/avatar1.png",
                    name: "Hi Chavez",
                    isOnline: true,
                    lastAction: "left 7 mins ago"
                })
            }
            this.rooms = arrRooms;
        },
        methods: {
            doSendMsg: function (event) {
                alert('Xin chÃ o ' + this.sendMsg + '!')
                if (event) {
                    alert(event.target.tagName)
                }
            }
        }
    }).mount('#app');
    $(document).ready(function () {
        STOMP_CHAT.activate();
    });

    const STOMP_CHAT = new StompJs.Client({
        brokerURL: 'ws://localhost:8080/ws/rtm/ws-chat',
        connectHeaders: {
            'Id-Token': Util.getLoginAuth().idToken,
            'Access-Token': Util.getLoginAuth().accessToken,
        },
        debug: function (str) {
            console.log(str);
        },
        reconnectDelay: 5000,
        heartbeatIncoming: 15000,
        heartbeatOutgoing: 15000
    });

    STOMP_CHAT.onConnect = (frame) => {
        console.log('Connected: ' + frame);
        let userTopic = '/topic/user-' + Util.getLoginAuth().userId;
        console.log(userTopic);
        STOMP_GLOBAL.subscribe(userTopic, (msg) => {
            console.log(msg.body);
        });
    };

    STOMP_CHAT.onWebSocketError = (error) => {
        console.error('Error with websocket', error);
    };

    STOMP_CHAT.onStompError = (frame) => {
        console.error('Broker reported error: ' + frame.headers['message']);
        console.error('Additional details: ' + frame.body);
    };
</script>
</html>